# --------------------------------------------------------------------------
# Class definition of WebThread - this thread controls the REST API
#
# Author: Benjamin Fuchs
# License: GPL3
#
# Website: https://github.com/bablokb/nerd-alarmclock
#
# --------------------------------------------------------------------------

from FlaskThread import FlaskThread
from threading import Thread
import requests

class WebThread(Thread):
  """ Web thread """

  # initialize object   ----------------------------------------------------

  def __init__(self, settings):
    """ Constructor """

    super(WebThread,self).__init__(name="WebThread")
    self._settings = settings
    self._port = settings.get_value('WEB', 'port', '5000')
    self._stop_event = settings.stop_event

  def run(self):
    """ run-method of thread """

    self._settings.log.msg("WebThread: running WebThread")
    flaskThread = FlaskThread(self._settings, self._port)
    flaskThread.start()
    while not self._stop_event.wait(0.5):
        True
    response = requests.post('http://localhost:' + str(self._port) + '/shutdown', json='{}')
    if response.status_code != 200:
       self._settings.log.msg("WebThread: Error shutting down server.")
    self._settings.log.msg("WebThread: terminating WebThread")
